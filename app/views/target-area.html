
{% extends "layout.html" %}

{% block pageTitle %}
{{ model.title }} - GOV.UK
{% endblock %}

{% block beforeContent %}
<div class="govuk-phase-banner">
  <p class="govuk-phase-banner__content">
    <strong class="govuk-tag govuk-phase-banner__content__tag">
      beta
    </strong>
    <span class="govuk-phase-banner__text">
      This is a new service â€“ your <a class="govuk-link" href="">feedback</a> will help us to improve it.
    </span>
  </p>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <a href="/find-location" class="defra-flood-location-link">Check another location</a>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <!-- Active -->
    <div class="defra-flood-status govuk-!-margin-bottom-3">
      {% if model.isActive %}
      <div class="defra-flood-status-item defra-flood-status-item--{{ model.targetArea.severity.hash }}">
        <span class="defra-flood-status-item__icon">
          {{ model.targetArea.severity.icon | safe }}
        </span>
        <div class="defra-flood-status-item__text">
          <strong>{{ model.targetArea.severity.subTitle }} - <a class="govuk-link" href="{{ model.targetArea.severity.actionLink }}">{{ model.targetArea.severity.tagline }}</a></strong>
        </div>
      </div>

      <!-- Inactive but active parent -->
      {% elif model.isParentActive %}
      <div class="defra-flood-status-item defra-flood-status-item--alert">
        <span class="defra-flood-status-item__icon">
          {{ model.targetArea.parentSeverity.icon | safe }}
        </span>
        <div class="defra-flood-status-item__text">
          {% if model.isRemoved %}
          The flood warning was removed, but there's still <a href="/target-area/{{ model.targetArea.parentId }}">a flood alert in the wider area</a>  
          {% else %}
          There are no flood warnings in this area, but there is <a href="/target-area/{{ model.targetArea.parentId }}">a flood alert in the wider area</a>
          {% endif %}
        </div>
      </div>

      <!-- Inactive or removed and inactive parent -->
      {% elif not model.isParentActive %}
      <div class="defra-flood-status-item">
        {% if model.isRemoved %}
        <div class="defra-flood-status-item__text">
          The flood {% if model.targetArea.type == 'warning' %}warning{% else %}alert{% endif %} was removed
        </div>
        {% else %}
        <div class="defra-flood-status-item__text">
          There are no flood {% if model.targetArea.type == 'warning' %}warnings{% else %}alerts{% endif %} in this area
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>

    <h1 class="govuk-heading-xl govuk-!-margin-bottom-1">
      {{ model.title }}
    </h1>
    {% if model.targetAreaMessageDate %}
    <p class="defra-flood-meta govuk-!-margin-top-1 govuk-!-margin-bottom-0">
      <time datetime="">{{ model.targetAreaMessageDate }}</time>
    </p>
    {% endif %}
    <span id="map-live"></span>

    <div class="govuk-!-padding-top-6">
      {% if model.targetArea.message %}
      <p>{{ model.targetArea.message }}</p>
      {% elif model.type == 'warning' %}
      <p>We'll update this page when there's a flood warning in the area.</p>
      <p>A flood warning means flooding to some property is expected. A severe flood warning means there's a danger to life.</p>
      {% else %}
      <p>We'll update this page when there's a flood alert in the area, which means flooding to low lying land is possible.</p>
      {% endif %}
      <p>Flood {{ model.targetArea.type }} area: {{ model.targetArea.area }}</p>
      <p>
        <a href="https://www.gov.uk/sign-up-for-flood-warnings" class="defra-link-icon">
          <svg width="20" height="20" viewBox="0 0 20 20"><path d="M6,15.026l-1,3.974l7,-3.974l4.674,0c1.284,0 2.326,-1.042 2.326,-2.326l0,-9.374c0,-1.284 -1.042,-2.326 -2.326,-2.326l-13.348,0c-1.284,0 -2.326,1.042 -2.326,2.326l0,9.374c0,1.284 1.042,2.326 2.326,2.326l2.674,0Z" style="fill:none;stroke:currentColor;stroke-width:2px;"/><circle cx="5.5" cy="8" r="1.5" style="fill:currentColor"/><circle cx="14.525" cy="8" r="1.5" style="fill:currentColor"/><circle cx="10" cy="8" r="1.5" style="fill:currentColor"/></svg>{% if model.isActive %}Get updates by phone, text or email{% else %}Get flood warnings by phone, text or email{% endif %}
        </a>
      </p>
      {% if model.isActive %}
      <p>Could this information be better?<br/><a href="">Tell us how to improve it.</a></p>
      {% endif %}

      <h2 class="govuk-heading-s">Latest river levels</h2>
      {% for level in model.targetArea.triggerLevels %}
      <div class="defra-panel">
        <p><a href="/station/{{ level.id }}">{{ level.riverName }} at {{ level.name }}</a></p>
        <div class="defra-flood-statistics">
          <dl class="defra-flood-statistics__list" aria-label="Latest readings">
            {% if level.latestTrend %}
            <div class="defra-flood-statistics__item">
              <dt class="defra-flood-statistics__key">
                Trend
              </dt>
              <dd class="defra-flood-statistics__value">
                {{ level.latestTrend | capitalize }}
              </dd>
            </div>
            {% endif %}
            <div class="defra-flood-statistics__item">
              <dt class="defra-flood-statistics__key">
                Height
              </dt>
              <dd class="defra-flood-statistics__value">
                {% if level.latestHeight < 0 and level.type != 'tide' %}&le; 0m{% else %}{{ level.latestHeight | round(2) }}m{% endif %}
              </dd>
            </div>
            {% if level.latestState  %}
            <div class="defra-flood-statistics__item"> 
              <dt class="defra-flood-statistics__key">
                State
              </dt>
              <dd class="defra-flood-statistics__value">
                {{ level.latestState | capitalize }}
              </dd>
            </div>
            {% endif %}
          </dl>
        </div>
        <p class="govuk-caption-s govuk-!-margin-top-3 govuk-!-margin-bottom-0">{{ level.latestDatetime }}</p>
      </div>
      {% endfor %}

      {% include "partials/context-footer.html" %}
    </div>
  </div>
  <div class="govuk-grid-column-one-third">
    {% include "partials/related-content.html" %}
  </div>
</div>

{% endblock %}

{% block pageScripts %}
<script>
  window.flood = {
    model: {
      id: {{ model.targetArea.id | dump | safe }},
      type: {{ model.targetArea.type | dump | safe }},
      name: {{ model.targetArea.name | dump | safe }},
      centroid: {{ model.targetArea.centroid | dump | safe }},
      bbox: {{ model.targetArea.bbox | dump | safe }},
      bingApiKey: {{ model.bingApiKey | dump | safe }}
    }
  }
</script>
<script src="/public/javascripts/target-area.js"></script>
{% endblock %}
