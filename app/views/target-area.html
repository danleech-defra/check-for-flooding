
{% extends "layout.html" %}

{% block pageTitle %}
{{ model.title }} - GOV.UK
{% endblock %}

{% block beforeContent %}
<div class="govuk-phase-banner">
  <p class="govuk-phase-banner__content">
    <strong class="govuk-tag govuk-phase-banner__content__tag">
      beta
    </strong>
    <span class="govuk-phase-banner__text">
      This is a new service â€“ your <a class="govuk-link" href="">feedback</a> will help us to improve it.
    </span>
  </p>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <a href="/find-location" class="defra-flood-location-link">Check another location</a>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <!-- Active -->
    <div class="defra-flood-status govuk-!-margin-bottom-3">
      {% if model.isActive %}
      <div class="defra-flood-status-item defra-flood-status-item--{{ model.targetArea.severity.hash }}">
        <span class="defra-flood-status-item__icon">
          {{ model.targetArea.severity.icon | safe }}
        </span>
        <div class="defra-flood-status-item__text">
          <strong>{{ model.targetArea.severity.subTitle }} - <a class="govuk-link" href="{{ model.targetArea.severity.actionLink }}">{{ model.targetArea.severity.tagline }}</a></strong>
        </div>
      </div>

      <!-- Inactive but active parent -->
      {% elif model.isParentActive %}
      <div class="defra-flood-status-item defra-flood-status-item--alert">
        <span class="defra-flood-status-item__icon">
          {{ model.targetArea.parentSeverity.icon | safe }}
        </span>
        <div class="defra-flood-status-item__text">
          {% if model.isRemoved %}
          The flood warning was removed, but there's still <a href="/target-area/{{ model.targetArea.parentId }}">a flood alert in the wider area</a>  
          {% else %}
          There are no flood warnings in this area, but there is <a href="/target-area/{{ model.targetArea.parentId }}">a flood alert in the wider area</a>
          {% endif %}
        </div>
      </div>

      <!-- Inactive or removed and inactive parent -->
      {% elif not model.isParentActive %}
      <div class="defra-flood-status-item">
        {% if model.isRemoved %}
        <div class="defra-flood-status-item__text">
          The flood {% if model.targetArea.type == 'warning' %}warning{% else %}alert{% endif %} was removed
        </div>
        {% else %}
        <div class="defra-flood-status-item__text">
          There are no flood {% if model.targetArea.type == 'warning' %}warnings{% else %}alerts{% endif %} in this area
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>

    <h1 class="govuk-heading-xl govuk-!-margin-bottom-1">
      {{ model.title }}
    </h1>
    {% if model.targetAreaMessageDate %}
    <p class="defra-flood-meta govuk-!-margin-top-1 govuk-!-margin-bottom-0">
      <time datetime="">{{ model.targetAreaMessageDate }}</time>
    </p>
    {% endif %}
    <span id="map-live"></span>

    <div class="govuk-!-padding-top-6">
      {% if model.targetArea.message %}
      <p>{{ model.targetArea.message }}</p>
      {% elif model.type == 'warning' %}
      <p>We'll update this page when there's a flood warning in the area.</p>
      <p>A flood warning means flooding to some property is expected. A severe flood warning means there's a danger to life.</p>
      {% else %}
      <p>We'll update this page when there's a flood alert in the area, which means flooding to low lying land is possible.</p>
      {% endif %}
      <p>Flood {{ model.targetArea.type }} area: {{ model.targetArea.area }}</p>
      <p>
        <a href="https://www.gov.uk/sign-up-for-flood-warnings" class="defra-link-icon">
          <svg viewBox="0 0 14 20" width="14" height="20" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" fill="currentColor"><path d="M9.27 15.747C9.27 16.99 8.26 18 7.016 18s-2.253-1.01-2.253-2.253H9.27zM6.015 1.86v-.859A1 1 0 0 1 7.016 0c.553 0 1.002.449 1.002 1.001v.859c2.284.465 4.006 2.487 4.006 4.907v4.357l1.628 1.661c.488.489.488 1.282 0 1.771a1.25 1.25 0 0 1-.886.366H1.252a1.25 1.25 0 0 1-.886-.366c-.488-.489-.488-1.282 0-1.771l1.643-1.661V6.767c0-2.42 1.721-4.442 4.006-4.907z"/></svg>{% if model.isActive %}Get updates by phone, text or email{% else %}Get flood warnings by phone, text or email{% endif %}
        </a>
        <!-- <a href="https://www.gov.uk/sign-up-for-flood-warnings">
          {% if model.isActive %}Get updates by phone, text or email{% else %}Get flood warnings by phone, text or email{% endif %}
        </a> -->
      </p>
      {% if model.isActive %}
      <p>Could this information be better?<br/><a href="">Tell us how to improve it.</a></p>
      {% endif %}

      <h2 class="govuk-heading-s">
        {% if model.targetArea.triggerLevels | length %}
        Check the latest river levels
        {% else %}
        Latest river, sea, groundwater and rainfall levels
        {% endif %}
      </h2>
      {% if model.targetArea.triggerLevels | length %}
      {% for level in model.targetArea.triggerLevels %}
      <div class="defra-panel">
        <p class="govuk-!-margin-bottom-0"><a href="/station/{{ level.id }}">{{ level.riverName }} at {{ level.name }}</a></p>
        <!-- <div class="defra-flood-statistics">
          <dl class="defra-flood-statistics__list" aria-label="Latest readings">
            {% if level.latestTrend %}
            <div class="defra-flood-statistics__item">
              <dt class="defra-flood-statistics__key">
                Trend
              </dt>
              <dd class="defra-flood-statistics__value">
                {{ level.latestTrend | capitalize }}
              </dd>
            </div>
            {% endif %}
            <div class="defra-flood-statistics__item">
              <dt class="defra-flood-statistics__key">
                Height
              </dt>
              <dd class="defra-flood-statistics__value">
                {% if level.latestHeight < 0 and level.type != 'tide' %}&le; 0m{% else %}{{ level.latestHeight | round(2) }}m{% endif %}
              </dd>
            </div>
            {% if level.latestState  %}
            <div class="defra-flood-statistics__item"> 
              <dt class="defra-flood-statistics__key">
                State
              </dt>
              <dd class="defra-flood-statistics__value">
                {{ level.latestState | capitalize }}
              </dd>
            </div>
            {% endif %}
          </dl>
        </div>
        <p class="govuk-caption-s govuk-!-margin-top-3 govuk-!-margin-bottom-0">{{ level.latestDatetime }}</p> -->
      </div>
      {% endfor %}
      {% else %}
      <p>There are around 3,500 measuring stations, and most are along main rivers and the coast. These levels can help you understand your flood risk now and over the next few days.</p>
      <p><a href="/river-sea-groundwater-rainfall-levels">Find a river, sea, groundwater or rainfall level in this area</a></p>
      {% endif %}
      {% include "partials/context-footer.html" %}
    </div>
  </div>
  <div class="govuk-grid-column-one-third">
    {% include "partials/related-content.html" %}
  </div>
</div>

{% endblock %}

{% block pageScripts %}
<script>
  window.flood = {
    model: {
      id: {{ model.targetArea.id | dump | safe }},
      type: {{ model.targetArea.type | dump | safe }},
      name: {{ model.targetArea.name | dump | safe }},
      centroid: {{ model.targetArea.centroid | dump | safe }},
      bbox: {{ model.targetArea.bbox | dump | safe }},
      bingApiKey: {{ model.bingApiKey | dump | safe }}
    }
  }
</script>
<script src="/public/javascripts/target-area.js"></script>
{% endblock %}
